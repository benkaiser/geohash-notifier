<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Simple service to send you an email when a geohash is nearby">
    <meta name="author" content="Benjamin Kaiser">

    <title>Starter Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/lumen/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      height: 400px;
      width: 100%;
    }
    .container {
      margin-bottom: 20px;
    }
    </style>
  </head>

  <body>
    <div class="container">

      <div class="starter-template">
        <h1>Geohash Notification Service</h1>
        <p class="lead">This is a service to notify you everytime a <a href="https://xkcd.com/426/">geohash</a> is within a given radius of a location.</p>
      </div>

      <form>
        <div class="form-group">
          <label for="email">Email address</label>
          <input type="email" class="form-control" name="email" id="email" placeholder="Email">
        </div>
        <div class="form-group">
          <label for="map">Select Location</label>
          <div id="map"></div>
          <input type="text" class="form-control" name="coordinates" id="coordinates" disabled>
        </div>
        <div class="form-group">
          <label for="radius">Radius (Kilometers)</label>
          <input type="number" oninput="updateRadius()" class="form-control" name="radius" id="radius" value="20">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <script>
      var map;
      var marker;
      var circle;
      var radius = 20;
      function initMap() {
        var Australia = {lat: -25.363, lng: 131.044};

        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3,
          center: Australia
        });

        google.maps.event.addListener(map, 'click', function(event) {
          placeMarker(event.latLng);
          updateCircle();
          updateInput(event.latLng);
        });
      }

      function placeMarker(location) {
        if (marker) marker.setMap(null);
        marker = new google.maps.Marker({
          position: location,
          map: map
        });
      }

      function updateInput(location) {
        var input = document.getElementById('coordinates');
        input.value = location.lat() + ',' +  location.lng();
      }

      function updateRadius() {
        radius = document.getElementById('radius').value;
        updateCircle();
      }

      function updateCircle() {
        if (!marker) return;
        if (circle) circle.setMap(null);
        circle = new google.maps.Circle({
          clickable: false,
          fillColor: '#AA0000',
          map: map,
          radius: radius * 1000,    // 10 miles in metres
          strokeOpacity: 0.1,
        });
        circle.bindTo('center', marker, 'position');
      }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOUy5PDsUbXDapmKEhRtOBF4YeQXNd-uI&callback=initMap" async defer></script>
  </body>
</html>
